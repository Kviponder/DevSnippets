<div class="container">
  <h2>Login</h2>
  <form id="loginForm" action="/api/users/login" method="POST">
    <div class="field">
      <label for="username" class="label">Username:</label>
      <div class="control">
        <input type="text" id="username" name="username" class="input" placeholder="Enter your username">
      </div>
    </div>
    <div class="field">
      <label for="password" class="label">Password:</label>
      <div class="control">
        <input type="password" id="password" name="password" class="input" placeholder="Enter your password">
      </div>
    </div>
    <div class="field">
      <div class="control">
        <button type="submit" class="button is-primary">Login</button>
      </div>
    </div>
  </form>
</div>

<div>
  <button type="button" onclick="window.location.href='/signup'" class="button is-link">Sign Up</button>
</div>

<!-- Display welcome message if the 'username' variable exists -->
{{#if username}}
  <div class="welcome-message" style="display: none;">
    <h3>You're logged in as: {{username}}!</h3>
    <p>You have successfully logged in.</p>
  </div>
{{/if}}

<script>
  // Get a reference to the login form
  const loginForm = document.getElementById('loginForm');

  // Add an event listener to the form for the 'submit' event
  loginForm.addEventListener('submit', async (event) => {
    event.preventDefault(); // Prevent the form from submitting normally

    // Get the values entered by the user
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;

    // Create an object to hold the login data
    const loginData = {
      username,
      password,
    };

    try {
      // Send a POST request to the login route with the login data
      const response = await fetch('/api/users/login', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(loginData),
      });

      // Parse the response as JSON
      const data = await response.json();

      if (response.ok) {
        // If the response is successful, show the welcome message
        // and store the token in local storage (or any other secure storage)
        const welcomeMessageElement = document.querySelector('.welcome-message');
        if (welcomeMessageElement) {
          welcomeMessageElement.style.display = 'block';
          // Set the logged-in username in the welcome message
          welcomeMessageElement.querySelector('h3').textContent = `You're logged in as: ${username}!`;
        }
        localStorage.setItem('token', data.token);

        // Add the token to the request headers for future API requests
        const token = localStorage.getItem('token');
        if (token) {
          fetch('/api/users', {
            headers: {
              Authorization: `Bearer ${token}`,
            },
          });
        }
      } else {
        // If the response is not successful, display an error message
        console.error('Login failed:', data.message);
      }
    } catch (error) {
      console.error('Error during login:', error);
    }
  });
</script>

